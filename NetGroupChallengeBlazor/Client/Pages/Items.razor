@page "/items"
@using Microsoft.AspNetCore.Authorization 
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using Core.Models
@using NetGroupChallengeBlazor.Client.Components
@attribute [Authorize(Roles = "User, Admin")]
@inject HttpClient Http


<ItemsListComponent Items="@ItemsList" OnUpdateCallback="@UpdateItemsAsync">

</ItemsListComponent>

@code {
    private List<Item> ItemsList = new List<Item>();

    protected override async Task OnInitializedAsync()
    {
        await UpdateItemsAsync();
    }

    private async Task UpdateItemsAsync() {
        try {
            var items = await Http.GetFromJsonAsync<List<Item>>($"api/items");
            if(items is not null) {
                ItemsList = items;
            }
        } catch (AccessTokenNotAvailableException exception) {
            exception.Redirect();
        } catch (Exception ex) {
            Console.WriteLine(ex.Message);
        }
    }

}
